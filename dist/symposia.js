/*
 postal
 Author: Jim Cowart (http://freshbrewedcode.com/jimcowart)
 License: Dual licensed MIT (http://www.opensource.org/licenses/mit-license) & GPL (http://www.opensource.org/licenses/gpl-license)
 Version 0.8.4
 */

/*!
Math.uuid.js (v1.4)
http://www.broofa.com
mailto:robert@broofa.com

Copyright (c) 2010 Robert Kieffer
Dual licensed under the MIT and GPL licenses.
*/

(function(e,t){typeof module=="object"&&module.exports?module.exports=function(e){return e=e||require("underscore"),t(e)}:typeof define=="function"&&define.amd?define("postal",["underscore"],function(n){return t(n,e)}):e.postal=t(e._,e)})(this,function(e,t,n){var r="/",i=0,s="postal",o=function(){var t;return function(n){var r=!1;return e.isString(n)?(r=n===t,t=n):(r=e.isEqual(n,t),t=e.clone(n)),!r}},u=function(){var t=[];return function(n){var r=!e.any(t,function(t){return e.isObject(n)||e.isArray(n)?e.isEqual(n,t):n===t});return r&&t.push(n),r}},a=function(e){this.channel=e||r};a.prototype.subscribe=function(){return arguments.length===1?new f(this.channel,arguments[0].topic,arguments[0].callback):new f(this.channel,arguments[0],arguments[1])},a.prototype.publish=function(){var e=arguments.length===1?Object.prototype.toString.call(arguments[0])==="[object String]"?{topic:arguments[0]}:arguments[0]:{topic:arguments[0],data:arguments[1]};return e.channel=this.channel,m.configuration.bus.publish(e)};var f=function(e,t,n){this.channel=e,this.topic=t,this.callback=n,this.constraints=[],this.context=null,m.configuration.bus.publish({channel:s,topic:"subscription.created",data:{event:"subscription.created",channel:e,topic:t}}),m.configuration.bus.subscribe(this)};f.prototype={unsubscribe:function(){this.inactive=!0,m.configuration.bus.unsubscribe(this),m.configuration.bus.publish({channel:s,topic:"subscription.removed",data:{event:"subscription.removed",channel:this.channel,topic:this.topic}})},defer:function(){var e=this.callback;return this.callback=function(t){setTimeout(function(){e(t)},0)},this},disposeAfter:function(t){if(e.isNaN(t)||t<=0)throw"The value provided to disposeAfter (maxCalls) must be a number greater than zero.";var n=this.callback,r=e.after(t,e.bind(function(){this.unsubscribe()},this));return this.callback=function(){n.apply(this.context,arguments),r()},this},distinctUntilChanged:function(){return this.withConstraint(new o),this},distinct:function(){return this.withConstraint(new u),this},once:function(){return this.disposeAfter(1),this},withConstraint:function(t){if(!e.isFunction(t))throw"Predicate constraint must be a function";return this.constraints.push(t),this},withConstraints:function(t){var n=this;return e.isArray(t)&&e.each(t,function(e){n.withConstraint(e)}),n},withContext:function(e){return this.context=e,this},withDebounce:function(t){if(e.isNaN(t))throw"Milliseconds must be a number";var n=this.callback;return this.callback=e.debounce(n,t),this},withDelay:function(t){if(e.isNaN(t))throw"Milliseconds must be a number";var n=this.callback;return this.callback=function(e){setTimeout(function(){n(e)},t)},this},withThrottle:function(t){if(e.isNaN(t))throw"Milliseconds must be a number";var n=this.callback;return this.callback=e.throttle(n,t),this},subscribe:function(e){return this.callback=e,this}};var l={cache:{},regex:{},compare:function(t,n){var r,i,s,o=this.cache[n]&&this.cache[n][t];return typeof o!="undefined"?o:((i=this.regex[t])||(r="^"+e.map(t.split("."),function(e){var t="";return!s||(t=s!=="#"?"\\.\\b":"\\b"),e==="#"?t+="[\\s\\S]*":e==="*"?t+="[^.]+":t+=e,s=e,t}).join("")+"$",i=this.regex[t]=new RegExp(r)),this.cache[n]=this.cache[n]||{},this.cache[n][t]=o=i.test(n),o)},reset:function(){this.cache={},this.regex={}}},c=function(t,n){!t.inactive&&m.configuration.resolver.compare(t.topic,n.topic)&&e.all(t.constraints,function(e){return e.call(t.context,n.data,n)})&&typeof t.callback=="function"&&t.callback.call(t.context,n.data,n)},h=!1,p=[],d=function(){while(p.length)p.shift().unsubscribe()},v={addWireTap:function(e){var t=this;return t.wireTaps.push(e),function(){var n=t.wireTaps.indexOf(e);n!==-1&&t.wireTaps.splice(n,1)}},publish:function(t){return h=!0,t.timeStamp=new Date,e.each(this.wireTaps,function(e){e(t.data,t)}),this.subscriptions[t.channel]&&e.each(this.subscriptions[t.channel],function(e){var n=0,r=e.length,i;while(n<r)(i=e[n++])&&c(i,t)}),h=!1,t},reset:function(){this.subscriptions&&(e.each(this.subscriptions,function(t){e.each(t,function(e){while(e.length)e.pop().unsubscribe()})}),this.subscriptions={})},subscribe:function(e){var t,n,r,i=this.subscriptions[e.channel],s;return i||(i=this.subscriptions[e.channel]={}),s=this.subscriptions[e.channel][e.topic],s||(s=this.subscriptions[e.channel][e.topic]=[]),s.push(e),e},subscriptions:{},wireTaps:[],unsubscribe:function(e){if(h){p.push(e);return}if(this.subscriptions[e.channel][e.topic]){var t=this.subscriptions[e.channel][e.topic].length,n=0;while(n<t){if(this.subscriptions[e.channel][e.topic][n]===e){this.subscriptions[e.channel][e.topic].splice(n,1);break}n+=1}}}};v.subscriptions[s]={};var m={configuration:{bus:v,resolver:l,DEFAULT_CHANNEL:r,SYSTEM_CHANNEL:s},ChannelDefinition:a,SubscriptionDefinition:f,channel:function(e){return new a(e)},subscribe:function(e){return new f(e.channel||r,e.topic,e.callback)},publish:function(e){return e.channel=e.channel||r,m.configuration.bus.publish(e)},addWireTap:function(e){return this.configuration.bus.addWireTap(e)},linkChannels:function(t,n){var i=[];return t=e.isArray(t)?t:[t],n=e.isArray(n)?n:[n],e.each(t,function(t){var s=t.topic||"#";e.each(n,function(n){var s=n.channel||r;i.push(m.subscribe({channel:t.channel||r,topic:t.topic||"#",callback:function(t,r){var i=e.clone(r);i.topic=e.isFunction(n.topic)?n.topic(r.topic):n.topic||r.topic,i.channel=s,i.data=t,m.publish(i)}}))})}),i},utils:{getSubscribersFor:function(){var e=arguments[0],t=arguments[1];return arguments.length===1&&(e=arguments[0].channel||m.configuration.DEFAULT_CHANNEL,t=arguments[0].topic),m.configuration.bus.subscriptions[e]&&m.configuration.bus.subscriptions[e].hasOwnProperty(t)?m.configuration.bus.subscriptions[e][t]:[]},reset:function(){m.configuration.bus.reset(),m.configuration.resolver.reset()}}};return m});var symposia=window.symposia||{};symposia.config={require:{shim:{jquery:{exports:"$"},underscore:{exports:"_"}},paths:{jquery:"vendor/jquery/jquery",underscore:"vendor/lodash/lodash",postal:"vendor/postaljs/lib/postal.min",diagnostics:"vendor/postaljs.diagnostics/lib/postal.diagnostics"},deps:["symposia/need"]},debug:!1},require.config(symposia.config.require),define("symposia/core",["underscore","jquery","postal"],function(e,t){return typeof window.symposia=="undefined"&&(window.symposia=symposia),symposia},function(e){console.log(e)}),function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(t,n){var r=e,i=[],s;n=n||r.length;if(t)for(s=0;s<t;s++)i[s]=r[0|Math.random()*n];else{var o;i[8]=i[13]=i[18]=i[23]="-",i[14]="4";for(s=0;s<36;s++)i[s]||(o=0|Math.random()*16,i[s]=r[s==19?o&3|8:o])}return i.join("")},Math.uuidFast=function(){var t=e,n=new Array(36),r=0,i;for(var s=0;s<36;s++)s==8||s==13||s==18||s==23?n[s]="-":s==14?n[s]="4":(r<=2&&(r=33554432+Math.random()*16777216|0),i=r&15,r>>=4,n[s]=t[s==19?i&3|8:i]);return n.join("")},Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})}}(),define("symposia/need",function(){}),define("symposia/bus",["symposia/core","postal"],function(e,t){return e.bus=t,e}),define("symposia/sandbox",["jquery"],function(e){var t=function(t,n){return this.element=e("#"+n.id),{}};return t.prototype={},t}),define("symposia/Module",["symposia/core","symposia/sandbox"],function(e,t){var n=function(e){this._id=Math.uuid(),this.id=e.id,this.creator=e.creator,this.subscriptions=[],this.initialize=!0};return n.prototype={start:function(){this.instance=this.creator(new t(e,this.id)),this.instance.init()},stop:function(){}},n}),define("symposia/modules",["symposia","symposia/Module"],function(e,t){return console.log(e),e.modules={moduleData:{},get:function(e){if(this.isModule(e))return this.moduleData[e]},create:function(n,r,i){var s,o={},u={init:!0};if(typeof n!="object")throw new Error("Create must be passed an object");if(!_.isUndefined(r)&&!_.isFunction(r))throw new Error("Callback must be a function");for(s in n)if(n.hasOwnProperty(s)){_.extend(u,n[s].options);if(_.isFunction(n[s].creator)===!1)throw new Error("Creator should be an instance of Function");o=n[s].creator();if(_.isObject(o)===!1)throw new Error("Creator should return a public interface");if(_.isFunction(o.init)===!1&&_.isFunction(o.destroy)===!1)throw new Error("Module must have both init and destroy methods");o=null,this.moduleData[s]=new t({id:s,creator:n[s].creator}),this.moduleData[s].start&&e.modules.start(s)}if(typeof r=="function")return r(this.moduleData)},start:function(t){if(this.isModule(t))return _.isObject(this.moduleData[t].instance)?!1:(console.log(this.moduleData[t]),this.moduleData[t].start(),e.bus.publish({channel:"modules",topic:"module.started",data:{id:t}}),_.isObject(this.moduleData[t].instance))},stop:function(t){if(this.isModule(t))return _.isObject(this.moduleData[t].instance)?(e.bus.publish({channel:"modules",topic:"module.stopped",data:{id:t}}),this.moduleData[t].instance.destroy(),this.moduleData[t].instance=null,delete this.moduleData[t].instance):!1},stopAll:function(){var e;for(e in this.moduleData)this.moduleData.hasOwnProperty(e)&&this.stop(e)},getStarted:function(){var e=[];return _.each(this.moduleData,function(t){_.isObject(t.instance)&&e.push(t)}),e},search:function(e){return _.where(this.moduleData,e)},hasModules:function(){return this.moduleData.length!==0?!0:!1},isStarted:function(e){if(this.isModule(e))return _.isObject(this.moduleData[e].instance)},isModule:function(e){if(_.isUndefined(e))throw new Error("No id supplied");if(!_.isString(e))throw new Error("id must be a string, "+typeof e+" supplied");if(!_.has(this.moduleData,e))throw new Error("Unable to find module ["+e+"]");return!0}},e}),define("symposia",["symposia/core","symposia/need","symposia/bus","symposia/modules"],function(e){return console.log(e),e});